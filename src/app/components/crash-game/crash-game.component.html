<app-header 
    [balance]="balance" 
    [isConnected]="isConnected" 
    [balanceFlash]="balanceFlash">
</app-header>

<!-- Game History (Recent Multipliers) -->
<div class="w-full h-12 flex items-center px-6 gap-2 overflow-x-auto no-scrollbar border-b border-white/5 bg-[#1F2121]">
    <div class="text-[10px] text-slate-500 font-medium uppercase tracking-wider mr-2 shrink-0">History</div>
    <div class="flex gap-2 items-center">
        <div *ngFor="let historyItem of history" 
             [class.text-[#22C55E]]="historyItem >= 2.0"
             [class.text-[#EF4444]]="historyItem < 2.0"
             class="px-2 py-0.5 rounded bg-[#262828] text-xs font-medium border border-white/5 shrink-0">
            {{ historyItem.toFixed(2) }}x
        </div>
    </div>
</div>

<!-- Main Game Display -->
<main class="flex-1 relative flex flex-col items-center justify-center w-full max-w-md mx-auto px-6">
    
    <!-- Background Decor elements -->
    <div class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-20">
        <div [class.opacity-40]="phase === 'RUNNING' && isBetting && !cashedOut"
             [class.opacity-0]="phase === 'BETTING' || phase === 'CRASHED'"
             [class.bg-[#22C55E]]="phase === 'RUNNING'"
             [class.bg-[#EF4444]]="phase === 'CRASHED'"
             [class.bg-[#20B4C6]]="phase === 'BETTING'"
             class="w-64 h-64 rounded-full blur-[100px] transition-all duration-700 scale-50"></div>
    </div>

    <!-- Multiplier Area -->
    <div class="relative z-10 flex flex-col items-center text-center space-y-2">
        
        <div [class.text-white]="phase === 'BETTING'"
             [class.text-[#22C55E]]="phase === 'RUNNING'"
             [class.text-[#EF4444]]="phase === 'CRASHED'"
             class="text-[72px] leading-none font-semibold tracking-tighter tabular-nums transition-colors duration-150">
            {{ multiplier.toFixed(2) }}x
        </div>

        <!-- Status Badge -->
        <div *ngIf="phase === 'BETTING'" 
             class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium tracking-wide bg-yellow-500/10 text-yellow-500 border border-yellow-500/20 transition-all duration-300">
            <span class="w-1.5 h-1.5 rounded-full bg-yellow-500 mr-2 animate-pulse"></span>
            Betting Phase <span *ngIf="countdown > 0" class="ml-1">{{ countdown }}s</span>
        </div>

        <div *ngIf="phase === 'RUNNING'" 
             class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium tracking-wide bg-green-500/10 text-green-500 border border-green-500/20 transition-all duration-300">
            <span class="w-1.5 h-1.5 rounded-full bg-green-500 mr-2 animate-pulse"></span>
            Multiplier Running
        </div>

        <div *ngIf="phase === 'CRASHED'" 
             class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium tracking-wide bg-red-500/10 text-red-500 border border-red-500/20 transition-all duration-300">
            <iconify-icon icon="lucide:alert-circle" width="14" class="mr-2"></iconify-icon>
            Round Finished
        </div>

        <div *ngIf="isBetting && !cashedOut && phase === 'RUNNING'" 
             class="h-10 flex flex-col items-center justify-center transition-opacity duration-300">
            <span class="text-xs text-slate-400">Current Win</span>
            <span [class.text-white]="cashedOut" class="text-lg font-medium text-[#22C55E] tracking-tight">
                ${{ (betAmount * multiplier).toFixed(2) }}
            </span>
        </div>

        <div *ngIf="cashedOut && phase === 'RUNNING'" 
             class="h-10 flex flex-col items-center justify-center transition-opacity duration-300">
            <span class="text-xs text-slate-400">Cashed Out</span>
            <span class="text-lg font-medium text-white tracking-tight">
                Won ${{ winAmount.toFixed(2) }}
            </span>
        </div>
    </div>

</main>

<!-- Controls Area -->
<footer class="w-full max-w-md mx-auto bg-[#1F2121] p-6 pb-8 z-20">
    
    <!-- Bet Amount Controls -->
    <div class="mb-6 bg-[#262828] p-4 rounded-xl border border-white/5 shadow-lg">
        <div class="flex justify-between items-center mb-3">
            <label class="text-xs font-medium text-slate-400 uppercase tracking-wider">Bet Amount</label>
            <div class="text-xs text-slate-500">Max: $1000.00</div>
        </div>
        
        <div class="flex items-center gap-3">
            <div class="relative flex-1">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <span class="text-slate-400">$</span>
                </div>
                <input type="number" 
                       [(ngModel)]="betAmount" 
                       [disabled]="phase !== 'BETTING' || isBetting"
                       [min]="1" 
                       [max]="1000" 
                       [step]="1"
                       (blur)="validateBetAmount()"
                       class="w-full bg-[#1F2121] text-white font-medium text-lg rounded-lg border border-white/10 focus:border-[#20B4C6] focus:ring-1 focus:ring-[#20B4C6] pl-7 pr-3 py-3 outline-none transition-all placeholder-slate-600 appearance-none disabled:opacity-50">
            </div>
            <div class="flex gap-2">
                <button (click)="adjustBet(0.5)" 
                        [disabled]="phase !== 'BETTING' || isBetting"
                        class="px-3 py-3 rounded-lg bg-[#1F2121] border border-white/10 text-xs font-medium text-slate-300 hover:bg-white/5 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed">½</button>
                <button (click)="adjustBet(2)" 
                        [disabled]="phase !== 'BETTING' || isBetting"
                        class="px-3 py-3 rounded-lg bg-[#1F2121] border border-white/10 text-xs font-medium text-slate-300 hover:bg-white/5 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed">2×</button>
            </div>
        </div>
    </div>

    <!-- Main Action Button -->
    <button 
        [disabled]="getButtonDisabled()"
        (click)="onBetClick()"
        [class]="'w-full h-[120px] rounded-2xl flex flex-col items-center justify-center gap-1 transition-all duration-200 transform active:scale-[0.98] shadow-lg disabled:opacity-50 disabled:cursor-not-allowed group relative overflow-hidden ' + getButtonClasses()">
        
        <span class="absolute inset-0 bg-gradient-to-t from-black/10 to-transparent pointer-events-none"></span>
        
        <span class="text-2xl font-semibold tracking-tight relative z-10">{{ getButtonLabel() }}</span>
        <span class="text-sm font-medium text-white/80 relative z-10">{{ getButtonSubLabel() }}</span>
        
        <!-- Icon for visual interest -->
        <iconify-icon 
            icon="lucide:arrow-right" 
            width="24" 
            height="24" 
            class="absolute right-6 opacity-0 group-hover:opacity-100 transition-opacity duration-300 translate-x-[-10px] group-hover:translate-x-0"
            *ngIf="phase === 'BETTING' && !isBetting && !getButtonDisabled()">
        </iconify-icon>
    </button>

</footer>
